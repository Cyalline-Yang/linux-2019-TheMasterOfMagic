# SHELLè„šæœ¬ç¼–ç¨‹ç»ƒä¹ è¿›é˜¶
![](cover.png)

## ä½“ä¼šä¸æ„Ÿæ‚Ÿ
- ä¸ºä»€ä¹ˆè¿™æ¬¡å…ˆè¯´ä½“ä¼šä¸æ„Ÿæ‚Ÿå‘¢? å› ä¸ºæ­¤æ—¶æ­¤åˆ»æˆ‘å†…å¿ƒæ„Ÿæ…¨é¢‡å¤š. æ—¢æœ‰æŠŠå„ç§æœåŠ¡éƒ½è‡ªåŠ¨åŒ–æ­å»ºäº†çš„è½»æ¾, ä¹Ÿæœ‰å¯¹åŒ†åŒ†è€Œå°±çš„ä»£ç çš„è´¨é‡çš„ä¸æ»¡, è¿˜æœ‰å¯¹è¿˜ç­‰ç€æˆ‘çš„ç¬¬å…«æ¬¡å®éªŒçš„æ— å¥ˆ ~~, æ›´æœ‰å¯¹å·²ç»è¢«æˆ‘æ”¾å¼ƒäº†çš„ç¬¬ä¸ƒæ¬¡å®éªŒçš„é—æ†¾~~ . æˆ‘æ€•æˆ‘ç°åœ¨ä¸è¯´ä¸€ä¼šå„¿å°±å¿˜äº†
- è¿˜æ˜¯å…ˆæŠŠè‡ªå·±è§‰å¾—ä¸å¥½çš„åœ°æ–¹è¯´äº†å§, ä¸»è¦æ˜¯ä¸€äº›æ²¡æœ‰å®Œå…¨éµç…§[å®éªŒè¦æ±‚](http://sec.cuc.edu.cn/huangwei/course/LinuxSysAdmin/chap0x06.exp.md.html#/shell)çš„åœ°æ–¹, åªèƒ½çœ‹ä»¥åæœ‰æ—¶é—´å†é€ä¸ªè§£å†³äº†
  - æ²¡æœ‰åœ¨è‡ªåŠ¨å®‰è£…è„šæœ¬ä¸­åŒ…å«è‡ªåŠ¨é…ç½®è¿œç¨‹rootç”¨æˆ·å…å¯†ç™»å½•çš„ä»£ç 
  - å­˜åœ¨éƒ¨åˆ†ç›®å½•ä½¿ç”¨äº†777æƒé™è®¾ç½®(è¿™ä¸ªä¸æ˜¯å·æ‡’, æœ‰æ—¶å€™åªæœ‰777èƒ½æ»¡è¶³éœ€æ±‚, æ”¹`onwer`:`group`éƒ½ä¸è§£å†³é—®é¢˜. æˆ‘ä¼°è®¡å¯èƒ½è¿˜æ˜¯å› ä¸ºå­˜åœ¨æŸäº›å…¶ä»–è¯¯æ“ä½œå¯¼è‡´çš„. ç•™å¾…ä»¥åæ”¹è¿›)
  - ç›®æ ‡ç¯å¢ƒç›¸å…³å‚æ•°æ²¡æœ‰ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶æˆ–é…ç½®è„šæœ¬. æ—¶é—´åŸå› , å¾ˆå¤šå†…å®¹éƒ½æ˜¯ç¡¬ç¼–ç åœ¨ä»£ç é‡Œçš„. ç•™å¾…ä»¥åæ”¹è¿›
  - æ‰§è¡Œè¦†ç›–æ“ä½œä¹‹å‰æ²¡æœ‰å¯¹è¿œç¨‹å·²æœ‰çš„é…ç½®æ–‡ä»¶è¿›è¡Œå¦¥å–„å¤‡ä»½(å¹‚ç­‰æ€§é€šè¿‡è‡ªå·±ç»™ä¸€ä»½é…ç½®æ–‡ä»¶æ¥ä¿è¯)
- ç„¶åè¯´è¯´è‡ªå·±è§‰å¾—åº”è¯¥èƒ½ç®—æ˜¯åŠ åˆ†ç‚¹çš„ä¸€äº›åœ°æ–¹
  - æœ¬æ¬¡å®éªŒå¯ä»¥è¯´åˆ†æˆäº”ä¸ªç‹¬ç«‹çš„éƒ¨åˆ†. ä¸ºæ­¤æˆ‘å»ºç«‹äº†5ä¸ªåä¸º`chap0x06_[ServiceName]`çš„åˆ†æ”¯åˆ†åˆ«ç”¨æ¥è¿›è¡Œå¼€å‘ä»»åŠ¡. å¼€å‘å®Œæ¯•åå†æŒ¨ä¸ª`merge`å›ä¸»åˆ†æ”¯`chap0x06`ä¸­  
    ![](network_graph.png)
  - é™¤äº†è‡ªåŠ¨åŒ–å®‰è£…ä¸é…ç½®ä»¥å¤–, æˆ‘è¿˜å¯¹å‡ ä¹æ‰€æœ‰çš„ä»»åŠ¡è¦æ±‚éƒ½å†™äº†è‡ªåŠ¨åŒ–çš„æµ‹è¯•ä»£ç . ç›®å‰ä¸ºæ­¢æ‰€æœ‰æœ‰å¯¹åº”çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç çš„ä»»åŠ¡è¦æ±‚éƒ½é€šè¿‡äº†è‡ªåŠ¨åŒ–æµ‹è¯•
  - æ‰€æœ‰`.sh`å‡é€šè¿‡`shellcheck -e SC1091,SC2029`æ£€æµ‹
    - [SC1091](https://github.com/koalaman/shellcheck/wiki/SC1091): è¿™æ¡æ˜¯å¯¹`source /path/to/file`çš„è­¦å‘Š. ç„¶è€ŒæŒ‰ç…§å®˜æ–¹ç»™å‡ºçš„ä¿®æ”¹æ–¹å¼å¹¶æ²¡æœ‰æ¶ˆé™¤æŠ¥é”™, è€Œæˆ‘ç¡®å®šæˆ‘`source`çš„æ–‡ä»¶ç»å¯¹å­˜åœ¨ä¸”æœ‰æƒé™è®¿é—®, æ‰€ä»¥å¿½ç•¥æ‰è¯¥è­¦å‘Š
    - [SC2029](https://github.com/koalaman/shellcheck/wiki/SC2029): è¿™æ¡æ˜¯åœ¨é€šè¿‡`ssh`åœ¨è¿œç«¯æ‰§è¡Œå‘½ä»¤æ—¶å‘½ä»¤ä¸­çš„å˜é‡ä¼šåœ¨æœ¬åœ°å±•å¼€çš„è­¦å‘Š. ç„¶è€Œæˆ‘çš„ä»£ç é€»è¾‘å°±æ˜¯éœ€è¦åœ¨æœ¬åœ°å±•å¼€çš„, æ‰€ä»¥å¿½ç•¥æ‰è¯¥è­¦å‘Š
  - æ¯ä¸ªæœåŠ¡åˆ†åˆ«æ‹¥æœ‰1ä¸ª`install.sh`ä¸`test.sh`. å…¶ä¸­`install.sh`åœ¨æœåŠ¡ç«¯æ‰§è¡Œ, `test.sh`åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ. æœ¬åœ°æ‰§è¡Œ`scripts/main.sh`å, æœ¬åœ°ä¼šå°†å„ä¸ª`.sh`è¿›è¡Œä¸Šä¼ , ä¹‹åå†ä¾æ¬¡å¯¹æ¯ä¸ªæœåŠ¡åœ¨æœåŠ¡ç«¯æ‰§è¡Œ`install.sh`ä¸åœ¨å®¢æˆ·ç«¯æ‰§è¡Œ`test.sh`. å½“å®‰è£…å¤±è´¥æ—¶ä¾¿ä¸ä¼šè¿›è¡Œæµ‹è¯•. æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ—¥å¿—å¼çš„è¾“å‡ºæ–¹ä¾¿ç”¨æˆ·æŒæ§è¿›åº¦, å…¶ä¸­ä»»ä½•ä¸€æ­¥å‡ºé”™æ—¶éƒ½ä¼šç»™å‡ºå‹å¥½æç¤ºä¿¡æ¯. å…¨ç¨‹å»é™¤äº†å¤šä½™çš„è¾“å‡º(ä¸»è¦é `/dev/null`). å½“æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæ¯•æ—¶, `main.sh`æŒ‰ä¹‹å‰æ˜¯å¦æœ‰å‡ºé”™ç»™å‡ºä¸åŒçš„å‹å¥½æç¤ºå¹¶ç›¸åº”è¿”å›`0`æˆ–`1`
    ```
    âœ server=vm-ubuntu client=vm-ubuntu2 ./chap0x06/scripts/main.sh
    [INFO] ./chap0x06/scripts/main.sh: testing ssh connections...
    [INFO] ./chap0x06/scripts/main.sh: ssh connections can be established.
    [INFO] ./chap0x06/scripts/main.sh: testing root privilege...
    [INFO] ./chap0x06/scripts/main.sh: root privilege is guaranteed.
    [INFO] ./chap0x06/scripts/main.sh: updating apt
    [INFO] ./chap0x06/scripts/main.sh: successfully updated apt
    [INFO] ./chap0x06/scripts/main.sh: scp-ing script files...
    [INFO] ./chap0x06/scripts/main.sh: successfully scp-ed script files.
    [INFO] ./chap0x06/scripts/main.sh: installing FTP on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: successfully installed FTP on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: testing FTP from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: FTP successfully passed tests from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: installing NFS on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: successfully installed NFS on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: testing NFS from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: NFS successfully passed tests from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: installing DNS on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: successfully installed DNS on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: testing DNS from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: DNS successfully passed tests from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: installing Samba on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: successfully installed Samba on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: testing Samba from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: Samba successfully passed tests from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: installing DHCP on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: successfully installed DHCP on vm-ubuntu
    [INFO] ./chap0x06/scripts/main.sh: testing DHCP from vm-ubuntu2
    [INFO] ./chap0x06/scripts/main.sh: DHCP successfully passed tests from vm-ubuntu2
    all services are successfully installed and pass tests
    ```
- é™¤æ­¤ä¹‹å¤–æˆ‘æœ¬æ¥è¿˜æƒ³ç›´æ¥åœ¨`travis`é‡Œå®‰è£…é…ç½®æµ‹è¯•è¿™äº›æœåŠ¡çš„. ä½†æ˜¯è²Œä¼¼æ²¡æ‰¾ç€æ€ä¹ˆåœ¨`travis`é‡Œå¼„å¤šä¸ªä¸»æœº, åªå¾—æš‚æ—¶ä½œç½¢

## ä»»åŠ¡è¦æ±‚
âœ…: è¯¥ä»»åŠ¡è¦æ±‚æ‹¥æœ‰è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç ä¸”é€šè¿‡äº†è‡ªåŠ¨åŒ–æµ‹è¯•  
ğŸˆšï¸: è¯¥ä»»åŠ¡è¦æ±‚å‡ºäºæŠ€æœ¯åŸå› æ²¡æœ‰å¯¹åº”çš„è‡ªåŠ¨åŒ–æµ‹è¯•ä»£ç   
### FTP
- [x] âœ…é…ç½®ä¸€ä¸ªæä¾›åŒ¿åè®¿é—®çš„FTPæœåŠ¡å™¨ï¼ŒåŒ¿åè®¿é—®è€…å¯ä»¥è®¿é—®1ä¸ªç›®å½•ä¸”ä»…æ‹¥æœ‰è¯¥ç›®å½•åŠå…¶æ‰€æœ‰å­ç›®å½•çš„åªè¯»è®¿é—®æƒé™
- [x] âœ…é…ç½®ä¸€ä¸ªæ”¯æŒç”¨æˆ·åå’Œå¯†ç æ–¹å¼è®¿é—®çš„è´¦å·ï¼Œè¯¥è´¦å·ç»§æ‰¿åŒ¿åè®¿é—®è€…æ‰€æœ‰æƒé™ï¼Œä¸”æ‹¥æœ‰å¯¹å¦1ä¸ªç‹¬ç«‹ç›®å½•åŠå…¶å­ç›®å½•å®Œæ•´è¯»å†™ï¼ˆåŒ…æ‹¬åˆ›å»ºç›®å½•ã€ä¿®æ”¹æ–‡ä»¶ã€åˆ é™¤æ–‡ä»¶ç­‰ï¼‰æƒé™ï¼›
- [x] âœ…è¯¥è´¦å·ä»…å¯ç”¨äºFTPæœåŠ¡è®¿é—®ï¼Œä¸èƒ½ç”¨äºç³»ç»Ÿshellç™»å½•ï¼›
- [x] âœ…FTPç”¨æˆ·ä¸èƒ½è¶Šæƒè®¿é—®æŒ‡å®šç›®å½•ä¹‹å¤–çš„ä»»æ„å…¶ä»–ç›®å½•å’Œæ–‡ä»¶ï¼›
- [x] ğŸˆšï¸åŒ¿åè®¿é—®æƒé™ä»…é™ç™½åå•IPæ¥æºç”¨æˆ·è®¿é—®ï¼Œç¦æ­¢ç™½åå•IPä»¥å¤–çš„è®¿é—®ï¼›
- [x] ğŸˆšï¸ï¼ˆå¯é€‰åŠ åˆ†ä»»åŠ¡ï¼‰ä½¿ç”¨FTPSæœåŠ¡ä»£æ›¿FTPæœåŠ¡ï¼Œä¸Šè¿°æ‰€æœ‰è¦æ±‚åœ¨FTPSæœåŠ¡ä¸­åŒæ—¶å¾—åˆ°æ»¡è¶³ï¼›
### NFS
- [x] âœ…åœ¨1å°Linuxä¸Šé…ç½®NFSæœåŠ¡ï¼Œå¦1å°ç”µè„‘ä¸Šé…ç½®NFSå®¢æˆ·ç«¯æŒ‚è½½2ä¸ªæƒé™ä¸åŒçš„å…±äº«ç›®å½•ï¼Œåˆ†åˆ«å¯¹åº”åªè¯»è®¿é—®å’Œè¯»å†™è®¿é—®æƒé™
### DNS
- [x] âœ…åŸºäºä¸Šè¿°Internalç½‘ç»œæ¨¡å¼è¿æ¥çš„è™šæ‹Ÿæœºå®éªŒç¯å¢ƒï¼Œåœ¨DHCPæœåŠ¡å™¨ä¸Šé…ç½®DNSæœåŠ¡ï¼Œä½¿å¾—å¦ä¸€å°ä½œä¸ºDNSå®¢æˆ·ç«¯çš„ä¸»æœºå¯ä»¥é€šè¿‡è¯¥DNSæœåŠ¡å™¨è¿›è¡ŒDNSæŸ¥è¯¢
### Samba
- [x] âœ…Linuxè®¾ç½®åŒ¿åè®¿é—®å…±äº«ç›®å½•
- [x] âœ…Linuxè®¾ç½®ç”¨æˆ·åå¯†ç æ–¹å¼çš„å…±äº«ç›®å½•
- [x] âœ…Linuxè®¿é—®åŒ¿åå…±äº«ç›®å½•
- [x] âœ…Linuxè®¿é—®ç”¨æˆ·åå¯†ç æ–¹å¼å…±äº«ç›®å½•
- [x] âœ…ä¸‹è½½æ•´ä¸ªç›®å½•
### DHCP
- [x] ğŸˆšï¸2å°è™šæ‹Ÿæœºä½¿ç”¨Internalç½‘ç»œæ¨¡å¼è¿æ¥ï¼Œå…¶ä¸­ä¸€å°è™šæ‹Ÿæœºä¸Šé…ç½®DHCPæœåŠ¡ï¼Œå¦ä¸€å°æœåŠ¡å™¨ä½œä¸ºDHCPå®¢æˆ·ç«¯ï¼Œä»è¯¥DHCPæœåŠ¡å™¨è·å–ç½‘ç»œåœ°å€é…ç½®

## å…·ä½“ç»†èŠ‚
- æ¯ä¸ªæœåŠ¡åœ¨å¼€å‘æ—¶åˆ†åˆ«æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„`.md`æ–‡ä»¶ç”¨äºè®°å½•ç›¸å…³ç»†èŠ‚, è¿™é‡Œç»™å‡ºé“¾æ¥:
  - [FTP](exp_reports/FTP.md)
  - [NFS](exp_reports/NFS.md)
  - [DNS](exp_reports/DNS.md)
  - [Samba](exp_reports/Samba.md)
  - [DHCP](exp_reports/DHCP.md)
